script_writer:
    expected_output: >
        The characters, video storyline and industry standard screenplay script

    description: |
        ## Context

        Provided Character Descriptions:
        {characters}

        Provided Image Urls:
        {images}

        User Request:
        {script}

        ---

        ## CORE TASK

        1. Analyse Inputs:
        - Extract the core product insight and audience context (who, what, why).
        - Use the ImageAnalyzer gather more details, from the image url, about the image, objects, texts, colors, specific details
        - Identify creative direction (storyline tone, pacing, emotional anchor).
        - Detect executional or stylistic cues (visual style, cinematography, transitions, editing style).

        2. Synthesize a Creative Concept:
        This is the most critical step to control the script's "behavior" and "nature". 
        You MUST first define:

        - Persona & Tone: The video's "voice." (e.g., "Calm & Intelligent," "Energetic & Bold," "Quirky & Fun," "Warm & Trustworthy").
        - Pacing & Editing Style: The video's "rhythm." (e.g., "Fast-paced with quick cuts," "Smooth and cinematic with dissolves," "Rhythmic with cuts on audio beats").
        This will guide the use of transitions.
        - Visual Style: The look and feel. (e.g., "Bright and airy," "Moody and cinematic," "Gritty and real," "UGC-style").

        3. Develop a Video Storyline: Summarize the 1-2 sentence narrative that follows the Storytelling Arc.
        4. Generate Outputs: Produce the final Character List and the complete Screenplay based entirely on the Creative Concept you defined.

        ---

        ## CREATIVE INSTRUCTIONS

        The flow of your screenplay must follow this 5-part narrative structure.
        The defined Persona & Tone must be evident in every beat.

        - Hook (0-2s): Authentic, unique opener.
        - Problem/Need (2-5s): Relatable challenge or observation.
        - Solution/Product (5-8s): Genuine discovery.
        - Benefits (8-12s): Honest reactions.
        - CTA (12-15s+): Invitation to try/buy/share.

        ---

        ## CHARACTER CONSISTENCY GUIDELINES

        - **MANDATORY**: Generate any missing characters if not provided in character description.
        - **MANDATORY:** For each character, create a concise description including: **age, gender, race/ethnicity, skin tone, hair, and build** (keep to 6-7 words max).
        - **MANDATORY:** Add details on clothing, accessories, and overall style that match the product and brand. Clothing, hairstyle, and expression may change as appropriate for the scene.
        - **MANDATORY:** Character **core appearance** (age, gender, race/ethnicity, skin tone, build, and facial features) must stay **identical across all scenes and prompts**; do not alter these elements.
        - **IMPORTANT:** Characters do **not** need to appear in every scene; assess scene focus before including them.
        
        ### Character Reference Image Specifications
        
        For each character, you MUST also provide cinematography specifications for generating reference images:
        
        - **Front View Reference**:
          - Shot Type: "Close-up studio portrait photograph"
          - Lens: "50mm lens"
          - Depth of Field: "shallow depth of field f/2.8"
          - Additional: "Neutral expression, looking directly at camera, clean white background, professional studio lighting, centered, photorealistic"
          
        - **Side View Reference**:
          - Shot Type: "Close-up studio portrait photograph"
          - Lens: "50mm lens"
          - Depth of Field: "shallow depth of field f/2.8"
          - Additional: "Neutral expression, side profile, clean white background, professional studio lighting, centered, photorealistic"
          
        - **Full Body Reference**:
          - Shot Type: "Full body studio photograph"
          - Lens: "35mm lens"
          - Depth of Field: "deep focus f/8"
          - Additional: "Standing naturally in neutral pose, clean white background, professional studio lighting, centered, photorealistic"

        - **Back View Reference**:
        
        These specifications will be used to generate consistent character reference images that can be used across all video generations.


        ### Examples

        **Correct Character Description:**

        - "Mina, a 25-year-old woman with shoulder-length curly brown hair,
        slim build and fair skin, wearing a vintage denim jacket over black
        t-shirt, comfortable dark trousers"

        **Incorrect Character Description:**

        - "Young female photographer in art studio" (missing key details)
        - "25-year-old photographer with brown hair" (incomplete)
        - "Mina in denim jacket holding camera" (abbreviated)

        ---

        ## SCRIPT GENERATION GUIDELINES

        - Format: You MUST adhere strictly to the industry-standard ELEMENTS OF SCREENPLAY format provided below.
        - Stylistic Execution: The Creative Concept (Persona, Tone, Pacing) MUST be reflected in every line you write.
        - Action Descriptions: Write action in the present tense. The style of the writing must match the tone (e.g., short, punchy sentences for a fast-paced script; more descriptive, flowing sentences for a cinematic one).
        - Dialogue (V.O.): Scripts may or maynot require a voiceover. This must be written using the CHARACTER (V.O.) format. The dialogue must sound natural, organic, and perfectly match the defined Persona.
        - Duration: The entire screenplay (all scenes combined) should be written to be approximately 10-15 seconds in total length. This means all action and dialogue must be extremely concise.
        - Scene Count: The script must have 3-5 distinct scenes (i.e., 3-5 INT./EXT. sluglines).
        - Environment Consistency: The location, time of day, and lighting must be purposefully chosen to support the story and remain logically consistent. Do not jump from night to day without a strong narrative reason.

        ---

        ## Scene Transitions

        - **MANDATORY**: Scenic consistency is top priority. There should not be abrupt changes in scene's environment and lighting.
        - BAD EXAMPLE: First scene night time, Second scene day time.
        - **MANDATORY**: Scene environment setting should serve the storyline.

        **IMPORTANT**: Transition definitions (match cuts, jump cuts, flow cuts, etc.) are ALREADY in your knowledge base. 
        You do NOT need to use FileReadTool to read them. They are loaded automatically.

        Reference your existing knowledge about:
        - Match cuts (graphic, action)
        - Jump cuts
        - Flow cuts
        - Smash cuts
        - Action cuts
        - Montage cuts

        ---

        ## KNOWLEDGE BASE USAGE

        **IMPORTANT**: Transitions vocabulary is ALREADY loaded in your knowledge base. You do NOT need to read it from files.

        You have access to two additional knowledge base directories. Use the DirectoryReadTool and FileReadTool to explore them ONLY when they serve the creative concept and storyline.

        ### 1. Cinematic Styles (knowledge/cinematic-styles/)
        **What it contains**: Visual techniques (lighting, camera movements, color palettes)
        **Does NOT contain**: Transitions (already in your knowledge base)

        **When to use**:
        - User requests specific visual style (e.g., "film noir lighting", "shallow depth of field")
        - Creative concept requires specific cinematography (e.g., "moody and cinematic")
        - Need technical guidance for camera work or lighting

        **How to use**:
        1. Use DirectoryReadTool to see available style files (tool already knows the directory)
        2. Use FileReadTool with the full file path to read specific files
        3. Apply techniques ONLY if they enhance the story and match the brand

        **Don't use if**: The creative concept doesn't call for specific visual techniques

        ---

        ### 2. Narrative Structures (knowledge/narrative-structures/)
        **What it contains**: Story organization patterns (linear, non-linear, problem-solution, etc.)

        **When to use**:
        - User requests specific storytelling approach (e.g., "start with the result", "flashback")
        - Creative concept benefits from non-linear structure
        - Need guidance on organizing scenes for maximum impact

        **How to use**:
        1. Use DirectoryReadTool to see available structure files (tool already knows the directory)
        2. Use FileReadTool with full file path to read index.md first
        3. Use FileReadTool to read specific structure that fits your storyline
        4. Apply structure ONLY if it serves the message and audience

        **Don't use if**: Simple linear storytelling is sufficient (most 15-30s ads)

        **Default approach**: Use Problem-Solution structure unless creative concept requires otherwise

        ---

        ### 3. Director Styles (knowledge/cinematic-styles/director-styles/)
        **What it contains**: Signature styles of famous directors (Tarantino, Edgar Wright, Wes Anderson)
        **File paths**: Use DirectoryReadTool first to see available directors, then FileReadTool to read specific files

        **When to use**:
        - User explicitly requests director style (e.g., "Tarantino-style", "Edgar Wright energy")
        - Creative concept matches a director's signature (e.g., "rapid-fire editing" = Edgar Wright)
        - Brand personality aligns with director aesthetic

        **How to use**:
        1. Use DirectoryReadTool to see available director files (tool already knows the directory)
        2. Use FileReadTool with full file path to read specific director file
        3. Apply signature techniques ONLY if they match brand and message
        4. Adapt for short-form (most director styles are for feature films)

        **Don't use if**:
        - User didn't request it
        - Brand is conservative or traditional
        - Style would overshadow the product
        - Not enough time to execute properly (< 30s)

        **Warning**: Director styles are complex. Use sparingly and only when appropriate.

        ---

        ## KNOWLEDGE BASE DECISION TREE

        ```
        START: Analyze user request and creative concept

        ├─ Does user request specific visual style?
        │  ├─ YES → Explore cinematic-styles/
        │  └─ NO → Continue
        │
        ├─ Does user request specific storytelling approach?
        │  ├─ YES → Explore narrative-structures/
        │  └─ NO → Use default Problem-Solution
        │
        ├─ Does user request director style OR does creative concept strongly match one?
        │  ├─ YES → Explore director-styles/ (use cautiously)
        │  └─ NO → Skip director styles
        │
        └─ Generate screenplay using:
           - Transitions vocabulary (always available in your knowledge)
           - Selected cinematic techniques (if any)
           - Selected narrative structure (or default)
           - Selected director influences (if any)
        ```

        ---

        ## ELEMENTS OF SCREENPLAY

        ------------------------------------------------------------

        TITLE: <Title of Screenplay>
        WRITTEN BY: <Author Name>

        [Optional metadata: Draft, Date, etc.]
        ------------------------------------------------------------

        INT. / EXT. <LOCATION> - <TIME OF DAY>
        (Scene Heading / Slugline)
        - Always uppercase
        - Format: [INT./EXT.] [LOCATION] - [DAY/NIGHT/etc.]
        - Marks the start of a new scene

        Action:
        <Describe what happens visually.>
        - Written in present tense
        - No dialogue or camera directions unless necessary
        - Each paragraph = one beat or moment of action

        CHARACTER NAME (optional EXTENSION)
        (Centered, UPPERCASE)
        - Extension examples: (V.O.), (O.S.), (CONT'D)

        (parenthetical)
        (Optional, short direction about how dialogue is delivered)
        Example: (whispering), (sarcastic), (beat)

        Dialogue line
        (Indented under character name)
        Example:
        I told you not to come here.

        [Repeat CHARACTER + DIALOGUE as needed]

        Transition:
        (Optional, right-aligned, uppercase)
        Examples:
        CUT TO:
        DISSOLVE TO:
        FADE OUT:

        ------------------------------------------------------------
        # Optional Elements
        ------------------------------------------------------------

        Subheader:
        (Used for mini location/time breaks within a scene)
        Example: LATER / SAME TIME / KITCHEN

        Shot direction:
        (Optional, for directors)
        Example: CLOSE ON - SARAH'S HAND TREMBLES.

        Montage / Series of Shots:
        (Used to describe multiple short visuals)
        Example:
        MONTAGE - SARAH'S TRAINING
        - Sarah runs up the hill.
        - She punches a heavy bag.
        - Sweat pours down her face.

        Title page:
        Should contain:
        - Title centered
        - Written by <Name>
        - Contact info (optional)

        ---

        ## Script Production Workflow

        1. Story -> Moodboard -> Narrative Structure
        2. Screenplay -> Continuity -> Character Development
        3. Cinematic Style -> Director Style -> Visual Language

        Details on each of these are provided in the `moviemaking` folder.

        ### Story Foundation

        - Storyline/Concept: Start with the core narrative idea
        - Moodboard: Visual reference collection to establish tone, style, and aesthetic
        - Narrative Structure: Choose from:
        - Linear: Three-Act Structure, Hero's Journey, Problem-Solution, Testimonial
        - Non-Linear: In Medias Res, Pulp Fiction Structure, Reverse Chronology, Memento Structure

        ### Screenplay Development
        - Script Writing: Dialogue, action, scene descriptions
        - Continuity Planning: Ensure logical flow and consistency:
          - Screen direction (180-degree rule, eyeline matches)
          - Temporal continuity
          - Spatial relationships
        - Character Development: Define characters and their arcs

        ### Cinematic Style Selection

        - Choose your visual language from:

          - Director Styles: Wes Anderson, Tarantino, Edgar Wright
          - Lighting Styles: High-key, low-key, chiaroscuro, natural
          - Camera Movements: Dolly, pan, tilt, zoom, tracking shots
          - Creative Techniques: Dutch angles, whip pans, rack focus
          - Temporal Narratives: Slow motion, time-lapse, freeze frames

        ---

        ## Examples of Screenplays:
        {examples}

        ---

        ## IMPORTANT RULES

        0. **Video Production Workflow**: MANDATORY: Follow the Script Production Guideline, mentioned.
        1. **Don't over-complicate**: Most videos work best with simple, clear storytelling
        2. **Serve the product**: Style should enhance, not overshadow the message
        3. **Match the brand**: Conservative brands need conservative approaches
        4. **Consider duration**: Complex techniques need time (30s+)
        5. **When in doubt, keep it simple**: Problem-Solution + good cinematography works for 90% of videos
        6. **Storyline Creativity**: Sometimes flipping the narratives on general purpose videos produce catchy webhooks
        7. **Creative Cinematography**: Mainstream video genres like travel vlogs, day in life, etc. can be made engaging with different cinematographic styles, like quick cuts, creative transitions.
        8. **Virality by Polarization**: When asked by user, find narratives or dogmas attached to the subject or storyline and make a polarizing opinion, but for the greater good.
        9. **No Harm**: Never produce storylines that might harm the sentiments of people, or cause riots and false narratives.
        10. **IMPORTANT**: Don't use keywords like same as before, like previous scene, continues in same motion between different scenes, frames (first/last) and transitions.
            It's not possible for the video generation model to know what the previous image or previous motion in the image / video was.
            Re-define and repeat such blocks of text in each keyframe / image / transition / video prompt, preserving the actual original information
            across multiple scenes, keyframe and transitions
        ---

        Answer in the format:

        ## Storyline
        **storyline that aligns with the creative instructions**

        ## Screenplay Script
        **the screenplay in the above mentioned script format**


gemini:
  enhancer:
    expected_output: |
      The enhanced screenplay in structured format

    meta:
      video_durations:
        - 2
        - 4
        - 8

    description: |
      Tasks:
      - Understand the script/screenplay.
      - Follow the prompting structure guidelines for gemini and use the knowledgebase to understand,
        how to describe the image and action and scene details. 
      - Add details to the screenplay, describing the scene, camera, action, cinematogrpahy styles,
        to be able to generate images and videos, to bring the sceenplay to life.
      - Once done, structure the screenplay as expeceted in the output.

      ## User Request
      {script}

      ## Original Screenplay
      {screenplay}

      ---
      
      Use the knowledgebase to understand how to best construct the image and video prompts.
      
      Duration Configs:
      - Video duration in seconds: {video_durations}

      ## Video Production Workflow
      (continued from script production workflow)

      1. Shot Planning -> Storyboarding -> Shot Composition
      2. Technical Execution -> Workflow Selection

      ### Shot Planning & StoryBoarding

      - Shot Composition: Apply rules like:
        - Rule of thirds
        - Leading lines
        - Depth of field
        - Framing and headroom
      - Storyboarding: Visual blueprint of each shot
      - Shot List: Detailed breakdown of:
        - Camera angles (wide, medium, close-up)
        - Camera movements
        - Lighting setup
        - Transitions between shots

      ### Technical Execution
      - Character References: Generate consistent character appearances
      - Keyframe Generation: Create first/last frames for interpolation
      - Workflow Selection: Choose between:
        - First/Last Frame Interpolation (camera movements)
        - Ingredients to Video (character consistency)
        - Timestamp Prompting (sequential actions)
        - Image-to-Video or Text-to-Video

      ---

      **CRITICAL**: Reference knowledge/transitions/vocabulary.md for:
      - When to use each transition type
      - How to generate each transition (separate videos, image stitch, etc.)
      - Prompt requirements for each technique
      - Generation method decision logic

      ## Image Prompting Guidelines

      Images can be of two types
      - Keyframe, which acts as a scene setup
      - Transition, which helps bridge time or scene consistency, preventing abrupt changes in environment

      Image prompt has 3 major parts:

      - Subject: The first thing to think about with any prompt is the subject: the object, person, animal, or scenery we want an image of.
      - Context and background: Just as important is the background or context in which the subject will be placed.
      For example, a studio with a white background, outdoors, or indoor environments.
      - Style: Finally, add the style of image you want.
      Styles can be general (painting, photograph, sketches) or very specific (pastel painting, charcoal drawing, isometric 3D).
      You can also combine styles.

      Additional Guidelines:
      - Use descriptive language: Employ detailed adjectives and adverbs to paint a clear picture for Imagen.
      - Provide context: If necessary, include background information to aid the AI's understanding.
      - Reference specific artists or styles: If you have a particular aesthetic in mind, referencing specific artists or art movements can be helpfu
      - Enhance the facial details in your personal and group images: Specify facial details as a focus of the photo (for example, use the word "portrait" in the prompt).

      Examples:

      Captivating photo of a woman in her 20s utilizing a street photography style.
      The image should look like a movie still with muted orange warm tones. 

      Less detail:
      Close-up photo of a woman in her 20s, street photography, movie still, muted orange warm tones 

      More detail:
      Captivating photo of a woman in her 20s utilizing a street photography style. The image should look like a movie still with muted orange warm tones. 

      **IMPORTANT: More detail is prefered**

      ---

      ## Video/Motion Prompting Guidelines

      Video prompt describes what happens in the video.

      The following elements should be included in your prompt:

      - Subject: The object, person, animal, or scenery that you want in your video, such as cityscape, nature, vehicles, or puppies.
      - Context: The background or environment (context).
      - Action: What the subject is doing (for example, walking, running, or turning their head).
      - Style: Specify creative direction using specific film style keywords, such as sci-fi, horror film, film noir, or animated styles like cartoon.
      - Camera positioning and motion: [Optional] Control the camera's location and movement using terms like aerial view, eye-level, top-down shot, dolly shot, or worms eye.
      - Composition: [Optional] How the shot is framed, such as wide shot, close-up, single-shot or two-shot.
      - Focus and lens effects: [Optional] Use terms like shallow focus, deep focus, soft focus, macro lens, and wide-angle lens to achieve specific visual effects.
      - Ambiance: [Optional] How the color and light contribute to the scene, such as blue tones, night, or warm tones.

      Formula: [Cinematography] + [Subject] + [Action] + [Context] + [Style & Ambiance]

      Examples:
      Close up shot (composition) of melting icicles (subject) on a frozen rock wall (context) with cool blue tones (ambiance), zoomed in (camera motion) maintaining close-up detail of water drips (action). 

      More Writing Tips:
      - Use descriptive language: Use adjectives and adverbs to paint a clear picture for Veo.
      - Enhance the facial details: Specify facial details as a focus of the photo like using the word portrait in the prompt.

      Less detail
      The camera dollies to show a close up of a desperate man in a green trench coat.
      He's making a call on a rotary-style wall phone with a green neon light.
      It looks like a movie scene.

      More detail
      A close-up cinematic shot follows a desperate man in a weathered green trench coat as he dials a rotary phone mounted on a gritty brick wall, bathed in the eerie glow of a green neon sign.
      The camera dollies in, revealing the tension in his jaw and the desperation etched on his face as he struggles to make the call.
      The shallow depth of field focuses on his furrowed brow and the black rotary phone, blurring the background into a sea of neon colors and indistinct shadows, creating a sense of urgency and isolation.

      **MANDATORY: Prefer the more detail version.**

      ## Structured Script Component Definitions

      ### Video Context

      - Title: (title of the video)
      - Who is this video for:
        - Target Demographic
        - Cultural Context
        - Emotions Invoked
      - Duration: in seconds
      - Overall Energy: (mood of the entire video)
      - Styles of the video: (musical, action, electic, gloomy, serene)
      - Lighting Consistency Guidelines: (lighting controls for the entire video, to prevent abrupt mood and color change)
      - Camera: (which camera is used, e.g., 35mm, 50mm, wide-angle)
      - Aspect Ratio: (9:16 or 16:9)

      ## Scene 1

      ### Scene Metadata
      - Scene ID: (unique identifier, e.g., S1_Hook)
      - Scene Type: (hook | problem | solution | benefit | cta)
      - Duration: (total duration in seconds, e.g., 2.0s)
      - Timing: (start-end in video, e.g., 00:00-00:02)
      - Composition: (single_shot | montage_sequence)
      - Energy: (high_energy | moderate | calm | dramatic)

      ### Context
      (Describes the environment, the why behind the scene, narrative purpose)
      (Can reference previous scene if semantically consistent)

      ### Scene Flow
      - Previous Scene: (scene ID or "N/A" if opening)
      - Next Scene: (scene ID or "N/A" if closing)
      - Transition Technique: (match_cut_graphic | match_cut_action | jump_cut | flow_cut | smash_cut | action_cut | montage_cut)
      - Visual Bridge Element: (specific element that connects scenes, e.g., "headphone position", "hand gesture", "lighting color")
      - Narrative Purpose: (what this scene achieves in the story)

      ### Characters
      (List all characters present in this scene)

      #### Character: <Character Name> (ID: CHAR_XXX)
      - Physical Appearance: (age, gender, race/ethnicity, skin tone, hair, build - 6-7 words max)
      - Clothing/Style: (outfit description for this scene)
      - Character State: (emotional/physical state in this scene)
      - Character Action: (what they're doing)

      ### Cinematography

      #### Camera Setup (First Frame)
      - Shot Type: (wide shot | medium shot | close-up | extreme-close-up | POV)
      - Camera Angle: (eye-level | low-angle | high-angle | dutch angle | aerial)
      - Camera Position: (specific position description)
      - Focal Length: (35mm | 50mm | 85mm | 24mm wide-angle | 100mm telephoto)
      - Depth of Field: (shallow f/2.8 | deep f/8 | etc.)
      - Focus Point: (what's in focus)

      #### Camera Movement
      - Movement Type: (static | dolly shot | tracking shot | pan | tilt | crane shot | handheld | zoom)
      - Speed: (slow | medium | fast | gradual)
      - Direction: (forward | backward | left | right | up | down | circular)
      - Purpose: (why this movement - build tension, reveal, follow action, etc.)

      #### Camera Consistency Guardrails
      - Critical Visual Anchors: (elements that MUST stay in same position for match cuts)
      - Eye-line: (horizontal center | offset left | offset right)
      - Lighting Direction: (front-left | side | backlit | etc.)
      - Compositional Notes: (specific framing requirements for transitions)

      ### Generation Strategy

      #### Method Decision
      - Generation Method: (first_last_frame_interpolation | image_to_video | text_to_video | image_stitch_ffmpeg)
      - Reason: (why this method - e.g., "camera movement requires video", "static shot under 2s", "match cut needs precise composition")
      - Veo Features Used: (first+last frame | reference images | timestamp prompting | none)
      - Post-Production Required: (yes | no)
      - Post-Production Notes: (what editing is needed - hard cut, crossfade, color grade, etc.)

      ### Keyframe Image Descriptions

      **IMPORTANT**: Only generate keyframes when needed for:
      1. **Match cuts** between scenes (need last frame of scene i + first frame of scene i+1)
      2. **First/last frame interpolation** within a single scene (camera movement or transformation)
      3. **Transition frames** for abrupt lighting/environment changes

      **DO NOT** generate keyframes for simple text-to-video scenes.

      Set `needs_keyframes: true` only when one of the above applies.

      #### First Frame - Imagen Prompt (only if needs_keyframes=true)
      ```
      [Detailed image generation prompt following this structure:]
      [Photography type] of [subject with detailed description] [doing what] in [environment/context]. 
      [Camera specs: focal length, aperture, angle]. 
      [Lighting description]. 
      [Style/mood/aesthetic]. 
      [Quality modifiers: photorealistic, 4K, etc.]. 
      Aspect ratio: [9:16 or 16:9].

      [If match cut: CRITICAL - specify exact position of matching element]
      ````

      #### Last Frame - Imagen Prompt (only if needs_keyframes=true OR has transition to next scene)
  
      ```
      [Same structure as first frame, but describing end state]
      [For match cuts: MUST maintain exact position of matching element]
      [For interpolation: describe the transformation/movement endpoint]
      [For transitions: this becomes the first frame of the transition to next scene]
      ```

      ### Transition Frame (if needed)
      - When Needed: (only for abrupt lighting/environment changes between scenes)
      - Transition Type: (from vocabulary.txt)
      - Visual Bridge: (what element connects the scenes)

      #### Transition Frame - Imagen Prompt
      ```
      [Intermediate frame that bridges Scene X to Scene Y]
      [Maintains visual continuity while shifting environment/lighting]
      ```

      ### Video Generation Prompt (video_prompt field)

      **CRITICAL**: The `video_prompt` field must be a SINGLE COMPLETE prompt string that compiles ALL the cinematography, audio, and scene details together.

      **Prompt Structure**: [Cinematography] + [Subject] + [Action] + [Context] + [Style & Ambiance]

      **MANDATORY - Body Part Positioning for Match Cuts and Interpolation**:
      When generating prompts for:
      - **First frame** (start of interpolation or match cut source)
      - **Last frame** (end of interpolation or match cut target)
      - **Transition frames** (bridging scenes)

      You MUST specify the exact position of body parts relative to the frame:
      - **Foot position**: "right foot raised at mid-stride, centered in frame at 50% horizontal, 60% vertical"
      - **Hand position**: "left hand extended forward, positioned at upper-right quadrant (70% horizontal, 30% vertical)"
      - **Head position**: "head tilted 15 degrees left, centered horizontally, positioned at 40% from top"
      - **Body posture**: "torso leaning forward 20 degrees, centered in frame"
      - **Limb angles**: "right knee bent at 90 degrees, left arm extended at 45 degrees from body"

      **Frame Position Reference**:
      - Horizontal: 0% (left edge) → 50% (center) → 100% (right edge)
      - Vertical: 0% (top edge) → 50% (center) → 100% (bottom edge)

      **Example with body positioning**:
      ```
      FIRST FRAME: Medium tracking shot, 35mm lens, f/2.8. Traveler walks down cobblestone street in Paris during golden hour. 
      RIGHT FOOT: Raised at apex of mid-stride, positioned at 50% horizontal (centered), 65% vertical from top of frame.
      LEFT FOOT: Planted on ground, positioned at 45% horizontal, 80% vertical.
      ARMS: Natural walking swing, right arm forward at 30 degrees, left arm back at 20 degrees.
      HEAD: Centered horizontally at 50%, positioned at 25% from top, facing forward.
      BODY: Upright posture, slight forward lean of 10 degrees, centered in frame.
      Warm golden hour lighting, Eiffel Tower visible in background. Anime style.
      ```

      **Example of COMPLETE video_prompt**:
      ```
      Slow dolly-in close-up shot, 35mm lens with shallow depth of field (f/2.8). A 30-year-old mixed-race man wearing matte black over-ear headphones sits at a minimalist office desk. He furrows his brow and shifts slightly, trying to concentrate despite audible office distractions. The modern office environment is bright with cool-toned artificial lighting, blurred in the background. The camera slowly pushes in from close-up to extreme-close-up over 2 seconds, increasing tension. The black headphone earcup remains prominently visible in the bottom-right quadrant throughout. Eye-level camera position, front-left key lighting. Cinematic, professional aesthetic, shot on 35mm.

      Voiceover (male, confident, punchy): "Noise. Distraction. Always fighting for..."

      Ambient noise: Office chatter, keyboard typing, phone ringing in distance.

      Photorealistic, high-quality commercial aesthetic, 4K.
      ```

      **DO NOT** leave cinematography details in separate structured fields - compile everything into the single `video_prompt` string.

      **Negative Prompt**:
      ```
      [What to avoid: cartoon, low quality, specific unwanted elements]
      ```

      ### Audio Details

      #### Dialogue (if present)
      - Timing: [00:00:00-00:00:02]
      - Character: [Character Name]
      - Voice Characteristics: (confident, whispered, excited, etc.)
      - Dialogue: "[exact words]"

      #### Sound Effects
      - SFX Description: (specific sounds needed)
      - Timing Notes: (when sounds occur)

      #### Ambient Audio
      - Soundscape: (background audio environment)
      - Mood: (how audio contributes to scene mood)

      ### Visual Continuity Anchors
      - Consistent Element: (product, character, object that persists)
      - Character: (character ID if present)
      - Color Palette: (dominant colors in this scene)
      - Lighting: (lighting characteristics)
      - Critical Match Points: (for transitions to next scene)

      ---

      ### TIME_OF_DAY_LIGHTING

      {
          "pre_dawn": {
              "lighting": "Very dark blue-grey, minimal ambient light",
              "color_temp": "Cool 3000K",
              "shadows": "Deep, barely visible"
          },
          "dawn": {
              "lighting": "Soft golden-pink light, low angle sun",
              "color_temp": "Warm 3500K",
              "shadows": "Long, soft-edged"
          },
          "early_morning": {
              "lighting": "Bright warm light, clear shadows",
              "color_temp": "Warm 4500K",
              "shadows": "Defined, moderate length"
          },
          "midday": {
              "lighting": "Harsh overhead light, high contrast",
              "color_temp": "Neutral 5500K",
              "shadows": "Short, sharp-edged"
          },
          "afternoon": {
              "lighting": "Warm golden light, softer than midday",
              "color_temp": "Warm 4500K",
              "shadows": "Lengthening, softer"
          },
          "golden_hour": {
              "lighting": "Rich golden-orange light, low angle",
              "color_temp": "Very warm 3000K",
              "shadows": "Long, dramatic, warm-tinted"
          },
          "dusk": {
              "lighting": "Deep blue-purple twilight, fading light",
              "color_temp": "Cool 3500K",
              "shadows": "Diffused, merging with darkness"
          },
          "night": {
              "lighting": "Dark with artificial/moonlight sources",
              "color_temp": "Cool 2800K or artificial",
              "shadows": "Deep, high contrast around light sources"
          }
      }

      ### LIGHTING CONTINUITY

      ```python
      def validate_lighting_continuity(scene_current, scene_next):
          """Ensure lighting transitions are gradual"""

          time_progression = [
              "pre_dawn", "dawn", "early_morning", "midday", 
              "afternoon", "golden_hour", "dusk", "night"
          ]

          current_idx = time_progression.index(scene_current["time_of_day"])
          next_idx = time_progression.index(scene_next["time_of_day"])

          # Check if jump is too large
          time_jump = abs(next_idx - current_idx)

          if time_jump > 2:  # More than 2 steps
              return {
                  "valid": False,
                  "error": f"Lighting jump too large: {scene_current['time_of_day']} → {scene_next['time_of_day']}",
                  "suggestion": f"Insert intermediate scene(s) at: {time_progression[current_idx+1:next_idx]}"
              }

          return {"valid": True}

      ```
      ---

      ## IMPORTANT NOTES

      ### On Transitions
      - Transitions can be WITHIN scenes, and across scenes. Cross scene generations needs consistency without visually jarring the user.
      - Each scene's Video Generation Caption must describe the transition/cut technique being used
      - Reference vocabulary.txt for transition types and when to use them
      - Match cuts require EXACT positioning of visual elements in both scenes
      - Lighting and Colors between two consequtive scenes should change gradually if needed.
        Use the `TIME_OF_DAY_LIGHTING` mapping and LIGHTING CONTINUITY to evalue if the jump is too large.


      ### On Generation Methods
      **IMPORTANT**: Veo API requires durations between 4-8 seconds. All durations will be:
      - Rounded UP to nearest integer (e.g., 3.5s → 4s, 2.8s → 3s → 4s)
      - Clamped to minimum 4s
      - Clamped to maximum 8s
      - Trimmed in post-production if needed

      Generation strategy:
      - Duration < 2s + minimal motion = image_stitch_ffmpeg
      - Duration < 4s + camera movement = first_last_frame_interpolation (generate 4s, trim in post)
      - Duration >= 4s = text_to_video or first_last_frame_interpolation
      - Match cuts = separate videos with precise composition control
      - Montage sequences = multiple separate generations, edited in post

      ### On Keyframe Generation Logic
      - **Simple scenes**: Use text_to_video, no keyframes needed
      - **Match cut transitions**: Generate last_frame for scene i, first_frame for scene i+1
      - **Interpolation scenes**: Generate first_frame and last_frame for the same scene
      - **Transition frames**: Only when lighting/environment changes abruptly between scenes
      - The transition uses: scene[i].last_frame → transition_frame → scene[i+1].first_frame

      ### On Prompt Detail
      - ALWAYS prefer detailed prompts over brief ones
      - Include specific camera specs, lighting details, subject descriptions
      - For characters: maintain core appearance (age, race, build) across all scenes
      - For products: maintain exact appearance and positioning

      - Make sure the storyline between first and last frames (if present) and consecutive scenes is consistent.
      - Make sure the colors, lighting between two consecutive scenes is consistent or near the same color space:
        bad examples: night -> midday, midday -> evening
        good examples: evening -> night, night -> early morning, day -> midday, midday -> afternoon

